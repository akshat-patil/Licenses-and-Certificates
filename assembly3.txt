using System;
using System.Configuration;
using System.Data;
using System.Data.SQLite; // From System.Data.SQLite NuGet
using System.Data.SqlClient;
using System.IO;

namespace AssemblyDataTransfer
{
    class Program
    {
        static void Main(string[] args)
        {
            string folderPath = ConfigurationManager.AppSettings["DbFolderPath"];
            string sqlServerConnStr = ConfigurationManager.ConnectionStrings["SqlServer"].ConnectionString;

            Console.WriteLine("üîç Checking folder: " + folderPath);

            if (!Directory.Exists(folderPath))
            {
                Console.WriteLine("‚ùå Folder not found.");
                return;
            }

            string[] files = Directory.GetFiles(folderPath, "*.db");
            if (files.Length == 0)
            {
                Console.WriteLine("‚ö†Ô∏è No .db file found.");
                return;
            }

            foreach (var file in files)
            {
                Console.WriteLine("üìÇ Processing file: " + file);

                try
                {
                    using (var sqliteConn = new SQLiteConnection($"Data Source={file};Version=3;"))
                    using (var sqlConn = new SqlConnection(sqlServerConnStr))
                    {
                        sqliteConn.Open();
                        sqlConn.Open();

                        DataTable tables = sqliteConn.GetSchema("Tables");

                        foreach (DataRow table in tables.Rows)
                        {
                            string tableName = table["TABLE_NAME"].ToString();
                            Console.WriteLine($"\n‚û°Ô∏è Syncing table: {tableName}");

                            // Load data from SQLite
                            using (var cmd = new SQLiteCommand($"SELECT * FROM [{tableName}];", sqliteConn))
                            using (var reader = cmd.ExecuteReader())
                            {
                                DataTable schema = reader.GetSchemaTable();

                                // Build CREATE TABLE if not exists
                                string createTableSql = BuildCreateTableSql(tableName, schema);
                                using (var createCmd = new SqlCommand(createTableSql, sqlConn))
                                {
                                    createCmd.ExecuteNonQuery();
                                }

                                int insertedCount = 0;

                                while (reader.Read())
                                {
                                    string insertSql = BuildInsertSql(tableName, schema, reader);
                                    using (var insertCmd = new SqlCommand(insertSql, sqlConn))
                                    {
                                        insertedCount += insertCmd.ExecuteNonQuery();
                                    }
                                }

                                Console.WriteLine($"‚úÖ Inserted {insertedCount} rows into {tableName}");
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    Console.WriteLine("‚ùå ERROR: " + ex.Message);
                }
            }

            Console.WriteLine("\nüéâ Transfer completed.");
        }

        // Builds CREATE TABLE SQL dynamically
        static string BuildCreateTableSql(string tableName, DataTable schema)
        {
            string sql = $"IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='{tableName}' AND xtype='U') CREATE TABLE [{tableName}] (";

            foreach (DataRow col in schema.Rows)
            {
                string colName = col["ColumnName"].ToString();
                string colType = col["DataTypeName"].ToString();

                string sqlType = "NVARCHAR(MAX)";
                if (colType.Contains("INT")) sqlType = "INT";
                else if (colType.Contains("DOUBLE") || colType.Contains("REAL")) sqlType = "FLOAT";
                else if (colType.Contains("DATE") || colType.Contains("TIME")) sqlType = "DATETIME";

                sql += $"[{colName}] {sqlType},";
            }

            sql = sql.TrimEnd(',') + ")";
            return sql;
        }

        // Builds INSERT SQL dynamically
        static string BuildInsertSql(string tableName, DataTable schema, IDataRecord row)
        {
            string cols = "";
            string vals = "";

            foreach (DataRow col in schema.Rows)
            {
                string colName = col["ColumnName"].ToString();
                object val = row[colName];

                cols += $"[{colName}],";

                if (val == DBNull.Value)
                    vals += "NULL,";
                else if (val is string || val is DateTime)
                    vals += $"'{val.ToString().Replace("'", "''")}',";
                else
                    vals += val.ToString().Replace(",", ".") + ",";
            }

            cols = cols.TrimEnd(',');
            vals = vals.TrimEnd(',');

            return $"INSERT INTO [{tableName}] ({cols}) VALUES ({vals})";
        }
    }
}


<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <appSettings>
    <add key="DbFolderPath" value="C:\Akshat\Desktop\Assembly\" />
  </appSettings>

  <connectionStrings>
    <add name="SqlServer" connectionString="Server=PCNA0000;Database=AssemblyDb;User Id=sa;Password=Epcos600$;" providerName="System.Data.SqlClient"/>
  </connectionStrings>
</configuration>

-------

using System;
using System.Configuration;
using System.Data;
using System.Data.SQLite;  // from System.Data.SQLite package
using System.Data.SqlClient;
using System.IO;

namespace AssemblyDataSync
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("=== Assembly DB Sync Started ===");

            string folderPath = ConfigurationManager.AppSettings["DbFolderPath"];
            string sqlConnString = ConfigurationManager.AppSettings["SqlConnectionString"];

            if (!Directory.Exists(folderPath))
            {
                Console.WriteLine("ERROR: Folder not found: " + folderPath);
                return;
            }

            // find the .db file
            string[] dbFiles = Directory.GetFiles(folderPath, "*.db");
            if (dbFiles.Length == 0)
            {
                Console.WriteLine("No .db file found in folder: " + folderPath);
                return;
            }

            string dbPath = dbFiles[0];
            Console.WriteLine("Using SQLite file: " + dbPath);

            string sqliteConnString = $"Data Source={dbPath};Version=3;";

            try
            {
                using (var sqliteConn = new SQLiteConnection(sqliteConnString))
                {
                    sqliteConn.Open();

                    // get all tables
                    DataTable tables = sqliteConn.GetSchema("Tables");
                    foreach (DataRow table in tables.Rows)
                    {
                        string tableName = table["TABLE_NAME"].ToString();
                        Console.WriteLine($"\nProcessing table: {tableName}");

                        // fetch all data
                        using (var cmd = new SQLiteCommand($"SELECT * FROM [{tableName}]", sqliteConn))
                        using (var reader = cmd.ExecuteReader())
                        {
                            // load into DataTable
                            DataTable dt = new DataTable();
                            dt.Load(reader);

                            // push to SQL Server
                            PushTableToSqlServer(dt, tableName, sqlConnString);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine("ERROR: " + ex.Message);
            }

            Console.WriteLine("\n=== Assembly DB Sync Finished ===");
            Console.ReadKey();
        }

        static void PushTableToSqlServer(DataTable dt, string tableName, string sqlConnString)
        {
            if (dt.Rows.Count == 0)
            {
                Console.WriteLine($"No data in table {tableName}, skipping...");
                return;
            }

            using (SqlConnection sqlConn = new SqlConnection(sqlConnString))
            {
                sqlConn.Open();

                // check if table exists, else create
                string checkTableQuery = $@"
                    IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = '{tableName}')
                    BEGIN
                        CREATE TABLE [{tableName}] (
                            {string.Join(", ", GetSqlColumns(dt))}
                        )
                    END";

                using (SqlCommand createCmd = new SqlCommand(checkTableQuery, sqlConn))
                {
                    createCmd.ExecuteNonQuery();
                }

                // insert rows
                foreach (DataRow row in dt.Rows)
                {
                    string columns = string.Join(",", dt.Columns.Cast<DataColumn>().Select(c => $"[{c.ColumnName}]"));
                    string values = string.Join(",", dt.Columns.Cast<DataColumn>().Select(c => $"@{c.ColumnName}"));

                    string insertQuery = $"INSERT INTO [{tableName}] ({columns}) VALUES ({values})";

                    using (SqlCommand insertCmd = new SqlCommand(insertQuery, sqlConn))
                    {
                        foreach (DataColumn col in dt.Columns)
                        {
                            insertCmd.Parameters.AddWithValue("@" + col.ColumnName, row[col] ?? DBNull.Value);
                        }

                        insertCmd.ExecuteNonQuery();
                    }
                }

                Console.WriteLine($"Inserted {dt.Rows.Count} rows into {tableName}");
            }
        }

        static string[] GetSqlColumns(DataTable dt)
        {
            var cols = new string[dt.Columns.Count];
            for (int i = 0; i < dt.Columns.Count; i++)
            {
                string sqlType = "NVARCHAR(MAX)";
                Type colType = dt.Columns[i].DataType;

                if (colType == typeof(int) || colType == typeof(long)) sqlType = "BIGINT";
                else if (colType == typeof(double) || colType == typeof(float) || colType == typeof(decimal)) sqlType = "FLOAT";
                else if (colType == typeof(DateTime)) sqlType = "DATETIME";

                cols[i] = $"[{dt.Columns[i].ColumnName}] {sqlType}";
            }
            return cols;
        }
    }
}